<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" type="text/css" href="/css/style.css">
    <meta charset="UTF-8">
    <title> Quiz </title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
</head>
<body>
    <div class="grid">
        <div id="quiz">
        <h1> Quiz </h1>
            <select id="thema" title="Ein Thema ausw채hlen">
                <option value="Mathe">Mathe</option>
                <option value="WBA">WBA</option>
                <option value="CGA">CGA</option>
                <option value="AP1">AP1</option>
            </select>
            <select id="level" title="Eine Schwierigkeitsgrad ausw채hlen">
                <option value="easy">einfach</option>
                <option value="moderate">mittelm채ssig</option>
                <option value="hard">schwierig</option>
            </select>
            <button id='startTest'>Test Starten</button>

        <div id="question">
            <h4>Frage </h4>
        </div>
        <div class="button">
            <button id="btn1"><span id="choice1"></span></button>
            <button id="btn2"><span id="choice2"></span></button>
            <button id="btn3"><span id="choice3"></span></button>
            <button id="btn4"><span id="choice4"></span></button>
            </div>
            <footer>
            <p id="progress">Question x of y.</p>
            </footer>
        </div>
    </div>
<script type="text/javascript">
    function einblenden(){
        $("#question").fadeIn('slow', function() {
            $("#question").show();
        });
        $("#btn1").fadeIn('slow', function() {
            $("#btn1").show();
        });
        $("#btn2").fadeIn('slow', function() {
            $("#btn2").show();
        });
        $("#btn3").fadeIn('slow', function() {
            $("#btn3").show();
        });
        $("#btn4").fadeIn('slow', function() {
            $("#btn4").show();
        });
        $("#progress").fadeIn('slow', function() {
            $("#progress").show();
        });
    }

    function ausblenden(){
        $("#thema").fadeOut('slow', function() {
            $("#thema").hide();
        });
        $("#level").fadeOut('slow', function() {
            $("#level").hide();
        });
        $("#startTest").fadeOut('slow', function() {
            $("#startTest").hide();
        });
    }

    document.getElementById("question").style.display = "none";
    document.getElementById("btn1").style.display ="none";
    document.getElementById("btn2").style.display ="none";
    document.getElementById("btn3").style.display ="none";
    document.getElementById("btn4").style.display ="none";
    document.getElementById("progress").style.display ="none";

    document.getElementById("startTest").onclick = function () {
        //test();
        ausblenden();
        einblenden();

    }


    document.getElementById("antworten").onclick = function (){
        let antwort = document.getElementById("antwort").value;
        checkAnswer(antwort);
        nextFrage();
    }

    let easyFragen;
    let moderateFragen;
    let hardFragen;
    let actualLevel;
    let impAntwort;
    let frageCounter = 1;
    let isRichtig;
    let frage;

    function test() {

        let obj = {};
        obj["thema"] = document.getElementById("thema").value;
        obj["level"] = document.getElementById("level").value;
        actualLevel = document.getElementById("level").value;
        //obj["author"] = document.getElementById("author").value;
        obj = JSON.stringify(obj);

        const settings = {
            "async": false,
            "crossDomain": true,
            "url": "http://127.0.0.1:3001/quiz/getQuestions",
            "method": "POST",
            "dataType": "json",
            "headers": {
                "Content-Type": "application/json",
                "Cache-Control": "no-cache",
                "x-access-token": localStorage.getItem('token')
            },
            "data": obj,
        };

        $.ajax(settings).done(function (result) {

            console.log(result.status, "Fragen wurden geladen");

           const easyFragen = result.easyQuestions;
           const moderateFragen = result.moderateQuestions;
           const hardFragen = result.hardQuestions;

           console.log(easyFragen);

            // Update UI. Vorbereitung f체r Fragen"

            //window.location.reload;
        })
            .fail(function (xhr, textStatus, error) {
                console.log("Fail");
                console.log(error);
            });

        ersteFrage();
    }



    function ersteFrage() {

        // @Franzi; Frage anzeigen. DOM Elemente zuweisen.
        //Du kannst die Frage selbst unter frage.frage finden

        if (actualLevel === 'easy'){
            frage = easyFragen[frageCounter];
            //Frage UI updaten
        }
        if (actualLevel === 'moderate'){
            frage = moderateFragen[frageCounter];
            //Frage UI updaten
        }
        if (actualLevel === 'hard'){
            frage = moderateFragen[frageCounter];
            //Frage UI updaten
        }
        frageCounter ++;
    }

    function checkAnswer(antwort){

        const settings = {
            "async": false,
            "crossDomain": true,
            "url": "http://127.0.0.1:3001/quiz/checkAntwort",
            "method": "POST",
            "dataType": "json",
            "headers": {
                "Content-Type": "application/json",
                "Cache-Control": "no-cache",
                "x-access-token": localStorage.getItem('token')
            },
            "data": antwort
        }

        $.ajax(settings).done(function (result) {

            console.log(result.status);
            isRichtig = result.isRichtig;
            if ((frageCounter % 2) === 1){
                impAntwort === isRichtig;
            }

        })
            .fail(function (xhr, textStatus, error) {
                console.log("Fail");
                console.log(error);
            });
    }

    function nextFrage() {

        if (frageCounter < 10){
            if (frageCounter < 4){
                if (actualLevel === 'easy'){
                    frage = easyFragen[frageCounter];
                    // Frage UI updaten
                }
                if (actualLevel === 'moderate'){
                    frage = moderateFragen[frageCounter];
                    //Frage UI updaten
                }
                if (actualLevel === 'hard'){
                    frage = [hardFragen];
                    //Frage UI updaten
                }
            } else {
                if ((frageCounter % 2) === 0) {
                    if (isRichtig && impAntwort) {
                        if (actualLevel === 'easy') {
                            frage = moderateFragen[frageCounter];
                            actualLevel = 'moderate';
                            // Frage UI updaten
                        }
                        if (actualLevel === 'moderate') {
                            frage = hardFragen[frageCounter];
                            actualLevel = 'hard';
                            //Frage UI updaten
                        }
                    }
                    if (!isRichtig && !impAntwort) {
                        if (actualLevel === 'moderate') {
                            frage = easyFragen[frageCounter];
                            actualLevel = 'easy';
                            //Frage UI updaten
                        }
                        if (actualLevel === 'hard') {
                            frage = moderateFragen[frageCounter];
                            actualLevel = 'moderate';
                            //Frage UI updaten
                        }
                    }
                }
            }
            frageCounter++;
        }
    }




</script>
</body></html>